{% extends "base.html" %}
{% load humanize %}
{% load i18n %} <!-- 1. Load the translation library -->

{% block title %}{% translate "Conversation about" %} {{ conversation.product.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <h4 class="mb-0">{% translate "Conversation about" %} <a href="{% url 'product_detail' conversation.product.id %}">{{ conversation.product.name }}</a></h4>
        </div>
        <div class="card-body" style="height: 60vh; overflow-y: auto; display: flex; flex-direction: column-reverse;" id="message-container">
            <div class="p-3">
                {% for message in conversation.messages.all reversed %}
                    <div class="d-flex flex-row {% if message.sender == user %}justify-content-end{% else %}justify-content-start{% endif %} mb-3">
                        <div class="p-2 {% if message.sender == user %}bg-primary text-white rounded-start rounded-top{% else %}bg-light text-dark rounded-end rounded-top{% endif %}" style="max-width: 75%;">
                            <p class="mb-1">{{ message.content }}</p>
                            <small class="text-{% if message.sender == user %}white-50{% else %}muted{% endif %} d-block text-end">
                                {{ message.timestamp|naturaltime }}
                            </small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="card-footer bg-white">
            <form method="POST" class="d-flex">
                {% csrf_token %}
                <input type="text" name="content" class="form-control" placeholder="{% translate 'Type your message...' %}" required autocomplete="off">
                <button class="btn btn-primary ms-2" type="submit">{% translate "Send" %}</button>
            </form>
        </div>
    </div>
    <a href="{% url 'inbox' %}" class="btn btn-secondary mt-3">{% translate "Back to Inbox" %}</a>
</div>
{% endblock %}